[DEFAULT]
env=local
gcs_base_path = gs://cv-datacafe-stg//retail-db//

bigquery_jar=C:\Users\Siddharth Jamadari\Desktop\datacafe\extra_jars\spark-bigquery-with-dependencies_2.12-0.27.1.jar
sql_jar=C:\Users\Siddharth Jamadari\Desktop\datacafe\retail_ingestion\extra_jars\mysql-connector-java-8.0.31.jar
pem_file=C:\Users\Siddharth Jamadari\Desktop\datacafe\creds\creds.json
project_id=evident-ethos-365308
dataset_name=fact_and_dimension
temporary_gcs_bucket=bigquery_tempfile

tables_run_seq=weekly_sales_analysis,sales_date
is_bigquery_read=True

[weekly_sales_analysis]
table_name=weekly_sales_analysis
dataset_name=analytics
required_input_tables_json=[{"table_name":"sales_fact","dataset_name":"fact_and_dimension","project_id":"evident-ethos-365308"},{"table_name":"customer_dimension","dataset_name":"fact_and_dimension","project_id":"evident-ethos-365308"},{"table_name":"date_dimension","dataset_name":"fact_and_dimension","project_id":"evident-ethos-365308"},{"table_name":"promotion_dimension","dataset_name":"fact_and_dimension","project_id":"evident-ethos-365308"}]
join_query=select dd.WeekOfYear, sf.ItemID, sum(sf.ExtendedAmount) as total_sales from sales_fact as sf join date_dimension dd on sf.BusinessDayDate = dd.BusinessDayDate where sf.PromotionalOfferID_1 is not null group by sf.ItemID, dd.WeekOfYear order by dd.WeekOfYear desc
destination_table=weekly_sales_analysis
transformation=
columns_to_select=WeekOfYear,ItemID,total_sales


[sales_date]
table_name=sales_date
dataset_name=analytics
required_input_tables_json=[{"table_name":"sales_fact","dataset_name":"fact_and_dimension","project_id":"evident-ethos-365308"},{"table_name":"date_dimension","dataset_name":"fact_and_dimension","project_id":"evident-ethos-365308"}]
join_query=select distinct sf.TransactionID, sf.RegularUnitPrice, sf.Quantity, sf.UnitDiscountAmount, sf.UnitCostPrice, sf.Amount_1, sf.NewPrice_1, dd.BusinessDayDate, dd.CalendarYearQuarter, dd.YearMonth, dd.DayOfYear, dd.WeekOfYear from sales_fact as sf join date_dimension dd on sf.BusinessDayDate = dd.BusinessDayDate
destination_table=sales_date
transformation=BusinessDayDate::date::Date,RegularUnitPrice:Quantity::multiply::gross_sales_inter,gross_sales_inter:UnitDiscountAmount::substract::net_sales,NewPrice_1:Quantity::multiply::Cost,net_sales:Cost:100::substractpercent::gross_margin
columns_to_select=Orders,gross_sales,discount,net_sales,average_order_value,gross_margin,Cost,Amount_1,Date,CalendarYearQuarter,YearMonth,DayOfYear,WeekOfYear
aggregation={"groupby_columns":"Date,CalendarYearQuarter,YearMonth,DayOfYear,WeekOfYear", "aggregation_dict":{"Orders":"count,TransactionID","gross_sales":"sum,gross_sales_inter","discount":"sum,UnitDiscountAmount","net_sales":"sum,net_sales","average_order_value":"avg,gross_sales_inter","gross_margin":"avg,gross_margin","Cost":"sum,Cost","Amount_1":"sum,Amount_1"}}
postprocessor=