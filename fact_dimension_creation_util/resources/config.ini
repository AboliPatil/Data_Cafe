[DEFAULT]
env=local
gcs_base_path = gs://cv-datacafe-stg//retail-db//

bigquery_jar=C:\Users\Siddharth Jamadari\Desktop\datacafe\extra_jars\spark-bigquery-with-dependencies_2.12-0.27.1.jar
sql_jar=C:\Users\Siddharth Jamadari\Desktop\datacafe\retail_ingestion\extra_jars\mysql-connector-java-8.0.31.jar
pem_file=C:\Users\Siddharth Jamadari\Desktop\datacafe\creds\creds.json
project_id=evident-ethos-365308
dataset_name=fact_and_dimension
temporary_gcs_bucket=bigquery_tempfile

tables_run_seq=sales_fact,customer_dimension,date_dimension,promotion_dimension

[sales_fact]
table_name=sales_fact
required_input_tables_json=[{"table_name":"CustomerOrder","base_path":"gs://cv-datacafe-stg//retail-db//"},{"table_name":"CustomerOrderLineItem","base_path":"gs://cv-datacafe-stg//retail-db//"},{"table_name":"Transaction"},{"table_name":"PaymentOnAccountLineItem","base_path":"gs://cv-datacafe-stg//retail-db//"},{"table_name":"CurrencyTypeCode","base_path":"gs://cv-datacafe-stg//retail-db//"},{"table_name":"CustomerOrderProductLineItem","base_path":"gs://cv-datacafe-stg//retail-db//"},{"table_name":"CustomerOrderProductPriceModifier","base_path":"gs://cv-datacafe-stg//retail-db//"},{"table_name":"CustomerOrderControlTransactionLineItem","base_path":"gs://cv-datacafe-stg//retail-db//"}]
join_query=select t.TransactionID,coli.RetailTransactionLineItemSequenceNumber, coctli.addressID,t.BusinessDayDate,t.CancelledFlag,t.VoidedFlag,t.SuspendedFlag,co.CustomerID,copli.FulfilledItemQuantity as UnitCount,co.ISOCurrencyCode,copli.ItemID, copli.SaleUnitRetailPriceAmount as RegularUnitPrice, copli.FulfilledItemQuantity as Quantity,copli.SaleUnitRetailPriceAmount as UnitCostPrice, coppm.Amount as UnitDiscountAmount, '' as IssuingRetailStoreID, coppm.PreviousPrice as PreviousPrice_1, coppm.Percent  as Percent_1, coppm.Amount as Amount_1, coppm.NewPrice as NewPrice_1, coppm.PromotionalOfferID as PromotionalOfferID_1,coppm.ReasonCode from CustomerOrder co join CustomerOrderLineItem coli on co.CustomerOrderID = coli.CustomerOrderID join Transaction t on coli.TransactionID = t.TransactionID join PaymentOnAccountLineItem poali on coli.RetailTransactionLineItemSequenceNumber = poali.RetailTransactionLineItemSequenceNumber join CurrencyTypeCode ctc on co.ISOCurrencyCode = ctc.ISOCurrencyCode join CustomerOrderProductLineItem copli on co.CustomerOrderID = copli.CustomerOrderID join CustomerOrderProductPriceModifier coppm on co.CustomerOrderID = coppm.CustomerOrderID join CustomerOrderControlTransactionLineItem coctli on co.CustomerOrderID = coctli.CustomerOrderID
destination_table=sales_fact
transformation=::lit::TransactionLevelDiscountAmount,1::lit::RegularUnitPriceQuantity,1::lit::ActualUnitPriceQuantity,RegularUnitPrice:RegularUnitPriceQuantity::multiply::ExtendedAmount
columns_to_select=TransactionID,RetailTransactionLineItemSequenceNumber,addressID,BusinessDayDate,CancelledFlag,VoidedFlag,SuspendedFlag,CustomerID,UnitCount,ISOCurrencyCode,ItemID,RegularUnitPrice,RegularUnitPriceQuantity,ActualUnitPriceQuantity,Quantity,UnitCostPrice,UnitDiscountAmount,IssuingRetailStoreID,TransactionLevelDiscountAmount,PreviousPrice_1,Percent_1,Amount_1,NewPrice_1,PromotionalOfferID_1,ReasonCode,ExtendedAmount

[customer_dimension]
table_name=customer_dimension
required_input_tables_json=[{"table_name":"Customer","base_path":"gs://cv-datacafe-stg//retail-db//"},{"table_name":"Party","base_path":"gs://cv-datacafe-stg//retail-db//"},{"table_name":"CustomerOrder"},{"table_name":"CustomerOrderControlTransactionLineItem","base_path":"gs://cv-datacafe-stg//retail-db//"},{"table_name":"Address","base_path":"gs://cv-datacafe-stg//retail-db//"},{"table_name":"CustomerAccount","base_path":"gs://cv-datacafe-stg//retail-db//"}]
join_query=select c.CustomerId, c.AnonymousFlag, ca.CustomerAccountEffectiveDate as RegistrationDateTime, p.PartyID, p.PartyTypeCode, c.Salutation, c.Name, coctli.addressID  from CustomerAccount ca join Customer c on ca.CustomerID = c.CustomerID join Party p on c.PartyID = p.PartyID join CustomerOrder co on c.CustomerID = co.CustomerID join CustomerOrderControlTransactionLineItem coctli on co.CustomerOrderID = coctli.CustomerOrderID join Address a on coctli.addressID = a.addressID
destination_table=customer_dimension
transformation=
columns_to_select=CustomerId,AnonymousFlag,RegistrationDateTime,PartyID,PartyTypeCode,Salutation,Name,AddressID

[date_dimension]
table_name=date_dimension
required_input_tables_json=[{"table_name":"Transaction","base_path":"gs://cv-datacafe-stg//retail-db//"}]
join_query=select t.BusinessDayDate from Transaction t
destination_table=date_dimension
transformation=BusinessDayDate::dayofweek::DayOfWeek,BusinessDayDate::dayofmonth::DayOfMonth,BusinessDayDate::dayofyear::DayOfYear,BusinessDayDate::monthnumber::MonthNumber,BusinessDayDate::monthname::MonthName,BusinessDayDate::yearmonth::YearMonth,BusinessDayDate::quarter::CalendarYearQuarter,BusinessDayDate::weekofyear::WeekOfYear

[promotion_dimension]
table_name=promotion_dimension
required_input_tables_json=[{"table_name":"PromotionalOffer","base_path":"gs://cv-datacafe-stg//retail-db//"}]
join_query=select po.PromotionalOfferID, po.BusinessUnitGroupID, po.EffectiveDate, po.ExpiryDate, po.StatusCode, po.OperatorDisplayName from PromotionalOffer po
destination_table=promotion_dimension
transformation=::lit::HolidayName,::lit::ISOCountryCode